<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>Quiz Recap MIS</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <h1>Quiz 1 & 2 (MIS) + คำถามทบทวนบทที่ 5</h1>
    <form id="quizForm"></form>
    <button onclick="checkAnswers()">ส่งคำตอบ</button>
    <div id="result"></div>

    <script>
        let questions = [];

        fetch('questions.json')
            .then(response => response.json())
            .then(data => {
                questions = data;
                renderQuestions();
            });

        function renderQuestions() {
            const form = document.getElementById('quizForm');
            questions.forEach(q => {
                const div = document.createElement('div');
                div.className = 'question';
                div.innerHTML = `<h3>${q.id}. ${q.question}</h3>` +
                    Object.entries(q.choices).map(([key, val]) =>
                        `<label><input type="radio" name="${q.id}" value="${key}"> ${val}</label><br>`
                    ).join('');
                form.appendChild(div);
            });
        }

        function checkAnswers() {
            let score = 0;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';

            questions.forEach(q => {
                const selected = document.querySelector(`input[name="${q.id}"]:checked`);
                const questionDiv = document.querySelector(`input[name="${q.id}"]`).closest('.question');

                const labels = questionDiv.querySelectorAll('label');
                labels.forEach(label => {
                    label.classList.remove('correct', 'incorrect');
                });

                const correctLabel = questionDiv.querySelector(`input[name="${q.id}"][value="${q.answer}"]`).parentElement;
                correctLabel.classList.add('correct');

                const feedback = document.createElement('div');
                feedback.className = 'feedback';
                feedback.style.marginTop = '10px';
                feedback.style.fontWeight = 'bold';

                if (selected) {
                    if (selected.value === q.answer) {
                        score++;
                        feedback.textContent = '✅ ตอบถูกต้อง';
                        feedback.style.color = '#007f5f';
                    } else {
                        const wrongLabel = selected.parentElement;
                        wrongLabel.classList.add('incorrect');
                        feedback.innerHTML = `❌ ตอบผิด — คำตอบที่ถูกคือ: <strong>${q.choices[q.answer]}</strong>`;
                        feedback.style.color = '#d00000';
                    }
                } else {
                    feedback.innerHTML = `⚠️ ยังไม่ได้เลือกคำตอบ — คำตอบที่ถูกคือ: <strong>${q.choices[q.answer]}</strong>`;
                    feedback.style.color = '#ff8800';
                }

                const oldFeedback = questionDiv.querySelector('.feedback');
                if (oldFeedback) oldFeedback.remove();
                questionDiv.appendChild(feedback);
            });

            resultDiv.textContent = `ได้คะแนน ${score} จาก ${questions.length} ข้อ`;
        }
    </script>

</body>

</html>